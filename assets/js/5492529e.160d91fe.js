"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[824],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return f}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=c(n),f=o,d=m["".concat(l,".").concat(f)]||m[f]||p[f]||a;return n?r.createElement(d,s(s({ref:t},u),{},{components:n})):r.createElement(d,s({ref:t},u))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var c=2;c<a;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6393:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return u},default:function(){return m}});var r=n(7462),o=n(3366),a=(n(7294),n(3905)),s=["components"],i={sidebar_position:5},l=void 0,c={unversionedId:"post_deployment_test",id:"post_deployment_test",title:"post_deployment_test",description:"Post deployment tests allow the execution of HTTP requests against the candidate version of a service before it any production",source:"@site/docs/post_deployment_test.md",sourceDirName:".",slug:"/post_deployment_test",permalink:"/consul-release-controller/post_deployment_test",editUrl:"https://github.com/nicholasjackson/consul-release-controller/tree/main/docs/templates/shared/docs/post_deployment_test.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Helm values",permalink:"/consul-release-controller/helm_values"},next:{title:"Webhook notification",permalink:"/consul-release-controller/webhooks"}},u=[],p={toc:u};function m(e){var t=e.components,n=(0,o.Z)(e,s);return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Post deployment tests allow the execution of HTTP requests against the candidate version of a service before it any production\ntraffic is sent to it."),(0,a.kt)("p",null,"When a post deployment test is defined, Consul Release Controller will expose an upstream target to the candidate, this allows\nall tests to be executed over the service mesh with no manual routing changes required."),(0,a.kt)("p",null,"If the tests pass, the release controller will progress with the strategy, however, should the tests fail, the release controller\nwill roll back the deployment."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'---\napiVersion: consul-release-controller.nicholasjackson.io/v1\nkind: Release\nmetadata:\n  name: api\n  namespace: default\nspec:\n  releaser:\n    pluginName: "consul"\n    config:\n      consulService: "api"\n  runtime:\n    pluginName: "kubernetes"\n    config:\n      deployment: "api-deployment"\n  postDeploymentTest:\n    pluginName: "http"\n    config:\n      path: "/"\n      method: "GET"\n      requiredTestPasses: 3\n      interval: "10s"\n      timeout: "120s"\n  strategy:\n    pluginName: "canary"\n    config:\n      initialDelay: "30s"\n      initialTraffic: 10\n      interval: "30s"\n      trafficStep: 20\n      maxTraffic: 100\n      errorThreshold: 5\n  monitor:\n    pluginName: "prometheus"\n    config:\n      address: "http://localhost:9090"\n      queries:\n        - name: "request-success"\n          preset: "envoy-request-success"\n          min: 99\n        - name: "request-duration"\n          preset: "envoy-request-duration"\n          min: 20\n          max: 200\n')))}m.isMDXComponent=!0}}]);